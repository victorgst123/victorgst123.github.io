<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Linear Scan - Find Max (Tailwind + jQuery)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="bg-gray-100">
<div class="flex min-h-screen">
  <!-- Left: Java code -->
  <div class="w-2/5 border-r border-gray-300 p-4 bg-white">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg font-semibold">Java Code (Linear Scan Max)</h2>
      <button id="toggleCode"
              class="px-3 py-1 border border-gray-700 rounded text-sm">
        Show Code
      </button>
    </div>

    <pre id="codeBlock"
         class="hidden bg-slate-900 text-slate-100 p-3 rounded text-xs overflow-x-auto"><code>public class Main {
    public static void main(String[] args) {
        int[] nums = {3, 7, 2, 9, 5};

        <span class="code-frag" id="c-max">int max = nums[0];  // initialize max</span>

        for (
            <span class="code-frag" id="c-for-init">int i = 1;</span>
            <span class="code-frag" id="c-for-cond">i &lt; nums.length;</span>
            <span class="code-frag" id="c-for-inc">i++</span>
        ) {
            <span class="code-frag" id="c-if">if (nums[i] &gt; max) {</span>
                <span class="code-frag" id="c-update">max = nums[i];</span>
            }
        }

        <span class="code-frag" id="c-print">System.out.println("Max: " + max);</span>
    }
}
</code></pre>
  </div>

  <!-- Right: visualization -->
  <div class="flex-1 p-6 space-y-4">
    <div>
      <h1 class="text-2xl font-semibold mb-1">Linear Scan to Find Maximum Value</h1>
      <p class="text-sm text-gray-600">
        We scan the array from left to right and keep track of the maximum value.
        Click <span class="font-semibold">Next Step</span> to follow the algorithm.
      </p>
    </div>

    <div id="array" class="flex gap-3 mt-2"></div>

    <div class="flex gap-3 mt-2">
      <button id="next"
              class="px-4 py-2 rounded bg-blue-600 text-white text-sm">
        Next Step
      </button>
      <button id="reset"
              class="px-4 py-2 rounded bg-gray-200 text-sm">
        Reset
      </button>
    </div>

    <div class="mt-4 p-3 bg-white rounded border border-gray-200 text-sm space-y-1">
      <div>
        <span class="font-semibold">Explanation:</span>
        <span id="msg">Click "Next Step" to start from initializing max.</span>
      </div>
      <div>
        <span class="font-semibold">Current index i:</span>
        <span id="curIdx">-</span>
      </div>
      <div>
        <span class="font-semibold">Current max:</span>
        <span id="curMax">-</span>
      </div>
    </div>
  </div>
</div>

<script>
  const nums = [3, 7, 2, 9, 5];
  let i, maxIdx, curIdx, phase, done;

  function renderArray() {
    const $a = $('#array').empty();
    nums.forEach((v, idx) => {
      $a.append(
        `<div class="w-16 h-16 border-2 border-gray-400 rounded-lg bg-white
                     flex flex-col items-center justify-center text-lg font-medium
                     relative" data-i="${idx}">
            <span>${v}</span>
            <span class="text-[10px] text-gray-500 mt-1">index ${idx}</span>
            <span class="tag-current hidden absolute -top-4 left-0 text-[10px] text-blue-600">current</span>
            <span class="tag-max hidden absolute -top-4 right-0 text-[10px] text-green-600">max</span>
         </div>`
      );
    });
  }

  function hiCode(id) {
    $('.code-frag').removeClass('bg-yellow-300 text-black rounded px-1');
    if (id) $('#' + id).addClass('bg-yellow-300 text-black rounded px-1');
  }

  function hiArray() {
    $('[data-i]').removeClass('border-blue-500 border-green-500 shadow-md');
    $('[data-i] .tag-current').addClass('hidden');
    $('[data-i] .tag-max').addClass('hidden');
    if (maxIdx >= 0) {
      const $m = $(`[data-i=${maxIdx}]`);
      $m.addClass('border-green-500 shadow-md');
      $m.find('.tag-max').removeClass('hidden');
    }
    if (curIdx >= 0) {
      const $c = $(`[data-i=${curIdx}]`);
      $c.addClass('border-blue-500 shadow-md');
      $c.find('.tag-current').removeClass('hidden');
    }
  }

  function setText(ex, idx, mx) {
    if (ex !== null) $('#msg').text(ex);
    if (idx !== null) $('#curIdx').text(idx);
    if (mx !== null) $('#curMax').text(mx);
  }

  function step() {
    if (done) return;

    switch (phase) {
      case 'initMax':
        hiCode('c-max');
        maxIdx = 0;
        curIdx = 0;
        hiArray();
        setText(`Initialize max = nums[0] = ${nums[0]}.`, 0, nums[0]);
        phase = 'forInit';
        break;

      case 'forInit':
        hiCode('c-for-init');
        i = 1;
        curIdx = 1;
        hiArray();
        setText('Run the initialization of the for loop: int i = 1.', i, nums[maxIdx]);
        phase = 'forCond';
        break;

      case 'forCond':
        hiCode('c-for-cond');
        if (i < nums.length) {
          curIdx = i;
          hiArray();
          setText(
            `Check condition i < nums.length: ${i} < ${nums.length} is true.`,
            i,
            nums[maxIdx]
          );
          phase = 'ifCompare';
        } else {
          curIdx = -1;
          hiArray();
          setText(
            `Check condition i < nums.length: ${i} < ${nums.length} is false, exit loop.`,
            '-',
            nums[maxIdx]
          );
          phase = 'print';
        }
        break;

      case 'ifCompare':
        hiCode('c-if');
        setText(
          `Compare nums[i] and max: nums[${i}] = ${nums[i]}, max = ${nums[maxIdx]}.`,
          i,
          nums[maxIdx]
        );
        phase = 'updateOrSkip';
        break;

      case 'updateOrSkip':
        if (nums[i] > nums[maxIdx]) {
          hiCode('c-update');
          maxIdx = i;
          hiArray();
          setText(
            `nums[${i}] is larger, update max to ${nums[i]}.`,
            i,
            nums[maxIdx]
          );
        } else {
          hiCode('c-if');
          setText(
            `nums[${i}] is not larger, keep max = ${nums[maxIdx]}.`,
            i,
            nums[maxIdx]
          );
        }
        phase = 'forInc';
        break;

      case 'forInc':
        hiCode('c-for-inc');
        i++;
        if (i < nums.length) {
          setText(`Run i++, now i = ${i}. Go back to condition.`, i, nums[maxIdx]);
          curIdx = i;
        } else {
          setText(`Run i++, now i = ${i}. Next condition check will end the loop.`, '-', nums[maxIdx]);
          curIdx = -1;
        }
        hiArray();
        phase = 'forCond';
        break;

      case 'print':
        hiCode('c-print');
        setText(
          `Loop finished. Final max = ${nums[maxIdx]} at index ${maxIdx}.`,
          '-',
          nums[maxIdx]
        );
        done = true;
        $('#next').prop('disabled', true).addClass('opacity-60 cursor-not-allowed');
        break;
    }
  }

  function reset() {
    i = 0;
    maxIdx = 0;
    curIdx = -1;
    phase = 'initMax';
    done = false;
    $('#next').prop('disabled', false).removeClass('opacity-60 cursor-not-allowed');
    renderArray();
    hiCode(null);
    hiArray();
    setText('Click "Next Step" to start from initializing max.', '-', '-');
  }

  $(function () {
    renderArray();
    reset();

    $('#next').on('click', step);
    $('#reset').on('click', reset);
    $('#toggleCode').on('click', function () {
      $('#codeBlock').toggleClass('hidden');
      $(this).text($('#codeBlock').hasClass('hidden') ? 'Show Code' : 'Hide Code');
    });
  });
</script>
</body>
</html>
